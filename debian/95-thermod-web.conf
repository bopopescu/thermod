server.modules += ( "mod_proxy", "mod_rewrite" )

alias.url += ( "/thermod" => "/usr/share/thermod/www" )

# Workaround to proxy and rewrite the requests to socket on lighttpd 1.4 as
# documented in the bug report http://redmine.lighttpd.net/issues/164#note-9.

$HTTP["url"] =~ "^/thermod/socket/" {
  proxy.server = ( "" => ( "" => ( "host" => "127.0.0.1", "port" => 4345 )))
}

$SERVER["socket"] == ":4345" {
  url.rewrite-once = ( "^/thermod/socket/(.*)$" => "/$1" )
  proxy.server = ( "" => ( "" => ( "host" => "127.0.0.1", "port" => 4344 )))
}